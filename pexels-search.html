<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pexels å›¾ç‰‡ä¸è§†é¢‘æœç´¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f5f5f5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .media-item {
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            background: white;
        }
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        .search-section {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .search-section h1 {
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .filter-section {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .media-container {
            position: relative;
            width: 100%;
        }
        .media-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .pagination-container {
            margin-top: 30px;
        }
        .media-info {
            padding: 12px;
            background-color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .media-info h5 {
            font-size: 14px;
            margin: 0 10px 5px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
            flex-grow: 1;
        }
        .media-info p {
            font-size: 11px;
            color: #6c757d;
            margin: 0 10px 5px 0;
            flex: 0 0 auto;
        }
        .download-link {
            margin-left: auto;
            font-size: 12px;
            color: #007bff;
            text-decoration: none;
        }
        .download-link:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            color: #6c757d;
            border-top: 1px solid #dee2e6;
        }
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
        }
        .card {
            transition: all 0.3s ease;
        }
        .search-box {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .media-item:hover .video-overlay {
            opacity: 1;
        }
        .play-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            font-size: 24px;
            cursor: pointer;
        }
        .cors-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }
        /* ä¿®å¤æ¸…ç©ºæŒ‰é’®é¢œè‰² */
        .btn-clear {
            background-color: #6c757d;
            color: white;
            border: none;
        }
        .btn-clear:hover {
            background-color: #5a6268;
            color: white;
        }
        /* å¤§å›¾æ¨¡æ€æ¡†æ ·å¼ */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .image-modal.active {
            opacity: 1;
            visibility: visible;
        }
        .image-modal-content {
            max-width: 95vw; /* å¢åŠ å›¾ç‰‡æœ€å¤§å®½åº¦ */
            max-height: 95vh; /* å¢åŠ å›¾ç‰‡æœ€å¤§é«˜åº¦ */
            object-fit: contain; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
        }
        .modal-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            z-index: 10000;
        }
        /* è§†é¢‘æ’­æ”¾å™¨å“åº”å¼æ ·å¼ */
        .video-responsive {
            position: relative;
            width: 100%;
            height: 85vh; /* å›ºå®šé«˜åº¦ */
            max-height: 90vh; /* æœ€å¤§é«˜åº¦ */
            display: flex;
            align-items: center;
            justify-content: center;
            background: black;
        }
        .video-responsive video {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain; /* ä¿æŒå®½é«˜æ¯”ï¼Œé€‚åˆå®¹å™¨ */
        }
        /* ç«–å±è§†é¢‘ç‰¹æ®Šæ ·å¼ */
        .video-responsive.vertical {
            height: 85vh;
        }
        /* è§†é¢‘æ¨¡æ€æ¡†è°ƒæ•´ */
        .modal-xl {
            max-width: 95vw; /* è°ƒæ•´æ¨¡æ€æ¡†å¤§å° */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="search-section text-center">
            <h1 class="mb-4">ğŸŒŸ Pexels å›¾ç‰‡ä¸è§†é¢‘æœç´¢</h1>
            <p class="lead">å‘ç°æ•°ç™¾ä¸‡å¼ å…è´¹é«˜è´¨é‡å›¾ç‰‡å’Œè§†é¢‘</p>
        </div>
        
        <div class="cors-warning" id="corsWarning">
            <strong>âš ï¸ æ³¨æ„:</strong> æ£€æµ‹åˆ°CORSè·¨åŸŸé™åˆ¶ã€‚é¦–æ¬¡åŠ è½½å¯èƒ½å¤±è´¥ï¼Œä½†æœç´¢åŠŸèƒ½é€šå¸¸ä»å¯ä½¿ç”¨ã€‚
            å¦‚éœ€ç¨³å®šä½¿ç”¨ï¼Œè¯·éƒ¨ç½²åˆ°æ”¯æŒåç«¯ä»£ç†çš„æœåŠ¡å™¨ã€‚
        </div>
        
        <div class="search-section search-box">
            <form id="searchForm" class="row g-3">
                <div class="col-md-4">
                    <input type="text" id="queryInput" class="form-control form-control-lg" placeholder="ğŸ” æœç´¢å…³é”®è¯..." value="ç¾å¥³">
                </div>
                <div class="col-md-2">
                    <select id="mediaType" class="form-select form-select-lg">
                        <option value="photos">ğŸ“¸ å›¾ç‰‡</option>
                        <option value="videos">ğŸ¥ è§†é¢‘</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary btn-lg w-100">æœç´¢</button>
                </div>
                <div class="col-md-3">
                    <button type="button" id="clearBtn" class="btn btn-clear btn-lg w-100">ğŸ—‘ï¸ æ¸…ç©º</button>
                </div>
            </form>
        </div>
        
        <div class="filter-section">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="orientationFilter" class="form-label fw-bold">ğŸ“ æ–¹å‘</label>
                    <select id="orientationFilter" class="form-select">
                        <option value="any">ä¸é™</option>
                        <option value="landscape">æ¨ªå‘</option>
                        <option value="portrait">çºµå‘</option>
                        <option value="square">æ–¹å½¢</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="sizeFilter" class="form-label fw-bold">ğŸ“ å°ºå¯¸</label>
                    <select id="sizeFilter" class="form-select">
                        <option value="any">ä¸é™</option>
                        <option value="large">å¤§å›¾</option>
                        <option value="medium">ä¸­å›¾</option>
                        <option value="small">å°å›¾</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div id="loadingIndicator" class="loading">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">åŠ è½½ä¸­...</span>
            </div>
            <h4 class="mt-3 text-primary">æ­£åœ¨ä¸ºæ‚¨å¯»æ‰¾ç²¾å½©å†…å®¹...</h4>
            <p class="text-muted">è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>
        </div>
        
        <div id="resultsContainer" class="row">
            <div class="col-12">
                <div class="text-center py-5">
                    <h3 class="text-muted">ğŸ‘‹ æ¬¢è¿ä½¿ç”¨Pexelsæœç´¢</h3>
                    <p class="text-muted">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</p>
                </div>
            </div>
        </div>
        
        <nav id="paginationContainer" class="pagination-container" style="display: none;">
            <ul class="pagination justify-content-center" id="paginationList"></ul>
        </nav>
        
        <footer>
            <p>åŸºäº <a href="https://www.pexels.com/api/documentation/" target="_blank" class="text-decoration-none">Pexels API</a> æ„å»º</p>
            <!--
            <p class="mb-0">ğŸ’¡ æç¤ºï¼šæ­¤å·¥å…·ç›´æ¥ä»å‰ç«¯è°ƒç”¨APIï¼Œå¯èƒ½å—CORSé™åˆ¶ã€‚å¦‚éœ€ç¨³å®šä½¿ç”¨ï¼Œè¯·éƒ¨ç½²åˆ°æ”¯æŒä»£ç†çš„æœåŠ¡å™¨ã€‚</p>
        -->
        </footer>
    </div>

    <!-- å›¾ç‰‡æ¨¡æ€æ¡† -->
    <div id="imageModal" class="image-modal">
        <span class="modal-close" id="closeImageModal">&times;</span>
        <img id="modalImage" class="image-modal-content" alt="å¤§å›¾é¢„è§ˆ">
    </div>

    <!-- è§†é¢‘æ¨¡æ€æ¡† -->
    <div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-fullscreen-md-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ğŸ¬ è§†é¢‘é¢„è§ˆ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-0">
                    <div class="video-responsive" id="videoContainer">
                        <video id="videoPlayer" controls>
                            <source src="" type="video/mp4">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ ‡ç­¾ã€‚
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // è¯·åœ¨æ­¤å¤„è¾“å…¥æ‚¨çš„Pexels APIå¯†é’¥
        const API_KEY = 'xDC24ho5apJjOxrE3DblofB7rKbMopSEMSgoTHtJXNzgskkMm5vwbHr6'; // æ›¿æ¢ä¸ºæ‚¨çš„APIå¯†é’¥
        
        const PHOTO_BASE_URL = 'https://api.pexels.com/v1';
        const VIDEO_BASE_URL = 'https://api.pexels.com/videos';
        
        let currentPage = 1;
        let currentQuery = '';
        let currentMediaType = 'photos';
        let currentOrientation = 'any';
        let currentSize = 'any';

        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('searchForm');
            const clearBtn = document.getElementById('clearBtn');
            const orientationFilter = document.getElementById('orientationFilter');
            const sizeFilter = document.getElementById('sizeFilter');

            searchForm.addEventListener('submit', handleSearch);
            clearBtn.addEventListener('click', clearResults);
            orientationFilter.addEventListener('change', handleFilterChange);
            sizeFilter.addEventListener('change', handleFilterChange);

            // å›¾ç‰‡æ¨¡æ€æ¡†åŠŸèƒ½
            const imageModal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const closeImageModal = document.getElementById('closeImageModal');
            
            closeImageModal.onclick = function() {
                imageModal.classList.remove('active');
            }
            
            window.onclick = function(event) {
                if (event.target === imageModal) {
                    imageModal.classList.remove('active');
                }
            }
        });

        function handleSearch(e) {
            e.preventDefault();
            currentQuery = document.getElementById('queryInput').value.trim();
            currentMediaType = document.getElementById('mediaType').value;
            currentOrientation = document.getElementById('orientationFilter').value;
            currentSize = document.getElementById('sizeFilter').value;
            
            if (!currentQuery) {
                alert('âš ï¸ è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            currentPage = 1;
            searchMedia();
        }

        function handleFilterChange() {
            currentOrientation = document.getElementById('orientationFilter').value;
            currentSize = document.getElementById('sizeFilter').value;
            
            // å¦‚æœå·²æœ‰æœç´¢ç»“æœï¼Œåˆ™é‡æ–°æœç´¢
            if (currentQuery) {
                searchMedia();
            }
        }

        async function searchMedia() {
            showLoading(true);
            hideCorsWarning(); // éšè—CORSè­¦å‘Š
            
            try {
                let url;
                const headers = {
                    'Authorization': API_KEY
                };
                
                const params = new URLSearchParams({
                    query: currentQuery,
                    per_page: 12,
                    page: currentPage
                });
                
                if (currentOrientation !== 'any') {
                    params.append('orientation', currentOrientation);
                }
                if (currentSize !== 'any') {
                    params.append('size', currentSize);
                }
                
                if (currentMediaType === 'videos') {
                    url = `${VIDEO_BASE_URL}/search?${params.toString()}`;
                } else {
                    url = `${PHOTO_BASE_URL}/search?${params.toString()}`;
                }
                
                const response = await fetch(url, { headers });
                
                if (!response.ok) {
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${response.statusText}`);
                }
                
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('æœç´¢é”™è¯¯:', error);
                // å°è¯•ä½¿ç”¨ä»£ç†APIæ¥ç»•è¿‡CORSé™åˆ¶
                await searchViaProxy(currentQuery, currentMediaType, currentOrientation, currentSize);
            } finally {
                showLoading(false);
            }
        }

        async function searchViaProxy(query, mediaType, orientation, size) {
            try {
                const params = new URLSearchParams({
                    query: query,
                    per_page: 12,
                    page: currentPage
                });
                
                if (orientation !== 'any') {
                    params.append('orientation', orientation);
                }
                if (size !== 'any') {
                    params.append('size', size);
                }
                
                let apiUrl;
                if (mediaType === 'videos') {
                    apiUrl = `${VIDEO_BASE_URL}/search?${params.toString()}`;
                } else {
                    apiUrl = `${PHOTO_BASE_URL}/search?${params.toString()}`;
                }
                
                // ä½¿ç”¨alloriginsä»£ç†
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
                const response = await fetch(proxyUrl);
                
                if (!response.ok) {
                    throw new Error(`ä»£ç†è¯·æ±‚å¤±è´¥: ${response.status}`);
                }
                
                const data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('ä»£ç†æœç´¢é”™è¯¯:', error);
                showError('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚å¯èƒ½ç”±äºCORSé™åˆ¶å¯¼è‡´ã€‚');
            }
        }

        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            const paginationContainer = document.getElementById('paginationContainer');
            const paginationList = document.getElementById('paginationList');
            
            container.innerHTML = '';
            
            let items = [];
            if (currentMediaType === 'photos') {
                items = data.photos || [];
            } else {
                items = data.videos || [];
                // å¯¹äºè§†é¢‘ï¼Œæˆ‘ä»¬åªå–å‰12ä¸ªå±•ç¤º
                items = items.slice(0, 12);
            }
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="text-center py-5">
                            <h3 class="text-muted">ğŸ˜¢ æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</h3>
                            <p class="text-muted">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</p>
                        </div>
                    </div>
                `;
                paginationContainer.style.display = 'none';
                return;
            }
            
            items.forEach(item => {
                const colDiv = document.createElement('div');
                colDiv.className = 'col-lg-3 col-md-4 col-sm-6';
                
                if (currentMediaType === 'photos') {
                    // æŸ¥æ‰¾åŸå§‹å›¾ç‰‡URL
                    let originalUrl = item.src.original || item.src.large2x || item.src.large || item.src.medium;
                    
                    colDiv.innerHTML = `
                        <div class="media-item card h-100">
                            <div class="media-container" style="padding-top: ${calculateAspectRatioPadding(item.width, item.height)}%;">
                                <img src="${item.src.medium}" alt="${item.alt || 'Image'}" class="media-content card-img-top img-clickable">
                            </div>
                            <div class="media-info card-body">
                                <h5 class="card-title">${item.photographer || 'æœªçŸ¥æ‘„å½±å¸ˆ'}</h5>
                                <p class="card-text">ID: ${item.id} | ${item.width}Ã—${item.height}</p>
                                <a href="${originalUrl}" class="download-link" target="_blank">ğŸ“¥ ä¸‹è½½</a>
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»æ˜¾ç¤ºå¤§å›¾åŠŸèƒ½
                    const imgElement = colDiv.querySelector('.img-clickable');
                    imgElement.addEventListener('click', () => {
                        showImageModal(item.src.large || item.src.original || item.src.medium);
                    });
                } else { // videos
                    // è·å–æœ€ä½³è´¨é‡çš„è§†é¢‘é“¾æ¥å’Œé¢„è§ˆå›¾
                    let videoUrl = '#';
                    let previewUrl = item.image || '';
                    let videoWidth = 16; // é»˜è®¤å®½é«˜æ¯”
                    let videoHeight = 9;
                    
                    if (item.video_files && item.video_files.length > 0) {
                        // å¯»æ‰¾æœ€é«˜åˆ†è¾¨ç‡çš„è§†é¢‘æ–‡ä»¶å¹¶è·å–å…¶å®½é«˜æ¯”
                        const highestRes = item.video_files.reduce((prev, current) => 
                            (prev.width * prev.height) > (current.width * current.height) ? prev : current
                        );
                        videoUrl = highestRes.link;
                        videoWidth = highestRes.width || 16;
                        videoHeight = highestRes.height || 9;
                    }
                    
                    // è®¡ç®—å®½é«˜æ¯”ç™¾åˆ†æ¯”
                    const aspectRatioPercent = (videoHeight/videoWidth)*100;
                    
                    colDiv.innerHTML = `
                        <div class="media-item card h-100 position-relative">
                            <div class="media-container" style="padding-top: ${aspectRatioPercent}%;">
                                <img src="${previewUrl}" alt="Video thumbnail" class="media-content card-img-top video-clickable">
                                <div class="video-overlay">
                                    <div class="play-icon video-play-btn">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-play-fill" viewBox="0 0 16 16">
                                          <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="media-info card-body">
                                <h5 class="card-title">ğŸ¬ è§†é¢‘ ID: ${item.id}</h5>
                                <p class="card-text">ä¸‹è½½æ¬¡æ•°: ${item.download_count || 0}</p>
                                <a href="${videoUrl}" class="download-link" target="_blank">ğŸ“¥ ä¸‹è½½</a>
                            </div>
                        </div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»æ’­æ”¾è§†é¢‘åŠŸèƒ½
                    const imgElement = colDiv.querySelector('.video-clickable');
                    imgElement.addEventListener('click', () => {
                        showVideoModal(videoUrl, videoWidth, videoHeight);
                    });
                    
                    // æ·»åŠ æ’­æ”¾æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                    const playBtn = colDiv.querySelector('.video-play-btn');
                    playBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // é˜»æ­¢å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
                        showVideoModal(videoUrl, videoWidth, videoHeight);
                    });
                }
                
                container.appendChild(colDiv);
            });
            
            // åˆ†é¡µå¤„ç†
            const totalResults = data.total_results || (currentMediaType === 'photos' ? data.photos?.length : data.videos?.length) || 0;
            const totalPages = Math.ceil(totalResults / 12);
            
            if (totalPages > 1) {
                paginationList.innerHTML = '';
                
                // ä¸Šä¸€é¡µ
                const prevLi = document.createElement('li');
                prevLi.className = `page-item ${currentPage <= 1 ? 'disabled' : ''}`;
                prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1})">â€¹ ä¸Šä¸€é¡µ</a>`;
                paginationList.appendChild(prevLi);
                
                // é¡µç 
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const li = document.createElement('li');
                    li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                    li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i})">${i}</a>`;
                    paginationList.appendChild(li);
                }
                
                // ä¸‹ä¸€é¡µ
                const nextLi = document.createElement('li');
                nextLi.className = `page-item ${currentPage >= totalPages ? 'disabled' : ''}`;
                nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1})">ä¸‹ä¸€é¡µ â€º</a>`;
                paginationList.appendChild(nextLi);
                
                paginationContainer.style.display = 'block';
            } else {
                paginationContainer.style.display = 'none';
            }
        }

        // è®¡ç®—å®½é«˜æ¯”å¡«å……ç™¾åˆ†æ¯”çš„è¾…åŠ©å‡½æ•°
        function calculateAspectRatioPadding(width, height) {
            if (!width || !height) return 66.67; // é»˜è®¤3:2æ¯”ä¾‹
            return (height / width) * 100;
        }

        function showImageModal(imageSrc) {
            const modalImage = document.getElementById('modalImage');
            const imageModal = document.getElementById('imageModal');
            
            modalImage.src = imageSrc;
            modalImage.style.maxWidth = '95vw';  // å¢åŠ å›¾ç‰‡æœ€å¤§å®½åº¦
            modalImage.style.maxHeight = '95vh'; // å¢åŠ å›¾ç‰‡æœ€å¤§é«˜åº¦
            imageModal.classList.add('active');
        }

        function showVideoModal(videoUrl, videoWidth, videoHeight) {
            // è®¾ç½®è§†é¢‘æº
            const videoPlayer = document.getElementById('videoPlayer');
            videoPlayer.innerHTML = `<source src="${videoUrl}" type="video/mp4">`;
            videoPlayer.load();
            videoPlayer.play();
            
            // æ›´æ–°è§†é¢‘å®¹å™¨çš„å®½é«˜æ¯”
            const videoContainer = document.getElementById('videoContainer');
            // ç§»é™¤ä¹‹å‰çš„å‚ç›´ç±»
            videoContainer.classList.remove('vertical');
            
            // è®¡ç®—å®½é«˜æ¯”
            const aspectRatio = videoHeight / videoWidth;
            
            // å¦‚æœæ˜¯ç«–å±è§†é¢‘ï¼ˆé«˜åº¦å¤§äºå®½åº¦ï¼‰ï¼Œæ·»åŠ ç‰¹æ®Šç±»
            if (aspectRatio > 1) {
                videoContainer.classList.add('vertical');
            }
            
            const modalElement = document.getElementById('videoModal');
            const modal = new bootstrap.Modal(modalElement);
            modal.show();
        }

        function changePage(page) {
            if (page < 1) page = 1;
            
            // è®¡ç®—æœ€å¤§é¡µæ•°
            let maxPage = 1;
            const allLinks = document.querySelectorAll('.page-item:not(.disabled) .page-link');
            if (allLinks.length > 0) {
                const pageNumbers = Array.from(allLinks).map(link => parseInt(link.textContent)).filter(num => !isNaN(num));
                maxPage = pageNumbers.length > 0 ? Math.max(...pageNumbers) : 1;
            }
            
            if (page > maxPage) page = maxPage;
            
            currentPage = page;
            
            if (currentQuery) {
                searchMedia();
            }
        }

        function clearResults() {
            document.getElementById('resultsContainer').innerHTML = `
                <div class="col-12">
                    <div class="text-center py-5">
                        <h3 class="text-muted">ğŸ‘‹ æ¬¢è¿ä½¿ç”¨Pexelsæœç´¢</h3>
                        <p class="text-muted">è¯·è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</p>
                    </div>
                </div>
            `;
            document.getElementById('queryInput').value = '';
            document.getElementById('paginationContainer').style.display = 'none';
            currentQuery = '';
        }

        function showLoading(show) {
            const loadingIndicator = document.getElementById('loadingIndicator');
            loadingIndicator.style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.getElementById('resultsContainer').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger text-center">
                        <h4>âŒ é”™è¯¯</h4>
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }

        function showCorsWarning() {
            document.getElementById('corsWarning').style.display = 'block';
        }

        function hideCorsWarning() {
            document.getElementById('corsWarning').style.display = 'none';
        }

        // å…¨å±€å‡½æ•°ä¾›åˆ†é¡µä½¿ç”¨
        window.changePage = changePage;
    </script>
</body>
</html>