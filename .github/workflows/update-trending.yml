name: Update YouTube Trending

on:
  workflow_dispatch: # 支持手动触发
    inputs:
      api_key:
        description: 'YouTube API Key'
        required: true
        type: string
  schedule:
    - cron: "37 0 * * *" # 定时触发，每天 UTC 时间 08:10 运行

jobs:
  update-trending:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Debug Environment Variables
        run: |
          echo "Event name: ${{ github.event_name }}"
          echo "API key (secrets): ${{ secrets.YOUTUBE_API_KEY }}"
          echo "API key (input): ${{ github.event.inputs.api_key }}"
          echo "Current UTC time: $(date -u)"
          echo "Current local time: $(date)"

      - name: Run trending script
        env:
          YOUTUBE_API_KEY: ${{ github.event_name == 'workflow_dispatch' && github.event.inputs.api_key || secrets.YOUTUBE_API_KEY }}
        run: |
          echo "Running script with API key..."
          python main.py

      - name: Commit and push if changed
        run: |
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          git add us.html hk.html tw.html index.html
          git commit -m "Update trending videos" || exit 0
          git push
